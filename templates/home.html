{% extends "base.html" %}
{% block title %}หน้าแรก{% endblock %}
{% block shell_classes %}app-shell--fluid{% endblock %}
{% block content %}
<div class="dashboard">
  <div class="dashboard__header">
    <div>
      <h1 class="dashboard__title">แดชบอร์ดภาพรวมงาน</h1>
      <p class="dashboard__subtitle">ติดตามสถานะกล้อง กลุ่ม Inference และแจ้งเตือนล่าสุดแบบเรียลไทม์</p>
    </div>
    <div class="dashboard__meta">
      <span class="badge bg-primary-subtle text-primary fw-semibold">
        อัปเดตล่าสุด <span id="dashboard-updated">-</span>
      </span>
    </div>
  </div>

  <section class="dashboard__metrics">
    <div class="metric-card" data-metric="total">
      <div class="metric-card__icon bg-primary text-white"><i class="bi bi-camera-video"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">จำนวนกล้องทั้งหมด</p>
        <p class="metric-card__value" id="metric-total">0</p>
      </div>
    </div>
    <div class="metric-card" data-metric="online">
      <div class="metric-card__icon bg-success text-white"><i class="bi bi-wifi"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">กล้องออนไลน์</p>
        <p class="metric-card__value" id="metric-online">0</p>
      </div>
    </div>
    <div class="metric-card" data-metric="running">
      <div class="metric-card__icon bg-warning text-dark"><i class="bi bi-cpu"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">Inference ที่กำลังรัน</p>
        <p class="metric-card__value" id="metric-running">0</p>
      </div>
    </div>
    <div class="metric-card" data-metric="alerts">
      <div class="metric-card__icon bg-danger text-white"><i class="bi bi-bell"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">แจ้งเตือนชั่วโมงล่าสุด</p>
        <p class="metric-card__value" id="metric-alerts">0</p>
      </div>
    </div>
    <div class="metric-card" data-metric="interval">
      <div class="metric-card__icon bg-info text-dark"><i class="bi bi-stopwatch"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">Interval เฉลี่ย (วินาที)</p>
        <p class="metric-card__value" id="metric-interval">0.0</p>
      </div>
    </div>
    <div class="metric-card" data-metric="fps">
      <div class="metric-card__icon bg-dark text-white"><i class="bi bi-graph-up"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">FPS เฉลี่ย</p>
        <p class="metric-card__value" id="metric-fps">0.0</p>
      </div>
    </div>
  </section>

  <div class="dashboard__content">
    <section class="dashboard__panel dashboard__panel--wide">
      <div class="panel-header">
        <div>
          <h2 class="panel-title">สถานะกล้องและงานประมวลผล</h2>
          <p class="panel-subtitle">ดูรายละเอียดกล้องทั้งหมดพร้อมสถานะ กลุ่มที่รันอยู่ และความถี่การประมวลผล</p>
        </div>
      </div>
      <div class="table-responsive dashboard__table-wrapper">
        <table class="table align-middle table-hover" id="camera-table">
          <thead>
            <tr>
              <th>กล้อง</th>
              <th>ชื่อ/แหล่งสัญญาณ</th>
              <th>สถานะ</th>
              <th>กลุ่มที่กำลังใช้</th>
              <th>Interval</th>
              <th>FPS โดยประมาณ</th>
              <th>ผลล่าสุด</th>
              <th>แจ้งเตือน</th>
              <th>อัปเดตล่าสุด</th>
            </tr>
          </thead>
          <tbody id="camera-table-body">
            <tr>
              <td colspan="9" class="text-center text-muted py-4">ไม่มีข้อมูลกล้อง</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <aside class="dashboard__sidebar">
      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">แจ้งเตือนล่าสุด</h2>
            <p class="panel-subtitle">ผลลัพธ์ที่ระบบบันทึกไว้ล่าสุด (สูงสุด 20 รายการ)</p>
          </div>
        </div>
        <ul class="timeline" id="alert-timeline">
          <li class="timeline__empty">ยังไม่มีแจ้งเตือน</li>
        </ul>
      </section>

      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">ตารางงานอัตโนมัติ</h2>
            <p class="panel-subtitle">กำหนดการรัน inference ตามเวลาที่ตั้งไว้</p>
          </div>
        </div>
        <div id="schedule-list" class="schedule-list">
          <div class="schedule-list__empty text-muted">ยังไม่มีการตั้งตารางงาน</div>
        </div>
      </section>
    </aside>
  </div>

  <section class="dashboard__panel">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพตัวอย่างสด</h2>
        <p class="panel-subtitle">ตรวจสอบภาพย่อจากกล้องที่กำลังรันอยู่ คลิกเพื่อเปิดเต็มหน้าจอ</p>
      </div>
    </div>
    <div class="stream-grid" id="stream-grid">
      <div class="stream-grid__empty text-muted">ยังไม่มีกล้องที่กำลังประมวลผล</div>
    </div>
  </section>
</div>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
