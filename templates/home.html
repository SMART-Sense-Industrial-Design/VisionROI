{% extends "base.html" %}
{% block title %}หน้าแรก{% endblock %}
{% block shell_classes %}app-shell--fluid{% endblock %}
{% block content %}
<div class="dashboard">
  <div class="dashboard__header">
    <div class="dashboard__heading">
      <div>
        <h1 class="dashboard__title">แดชบอร์ดภาพรวมงาน</h1>
        <p class="dashboard__subtitle">ติดตามสถานะกล้อง งาน Inference แบบกลุ่มและแบบหน้าได้ในที่เดียว</p>
      </div>
      <div class="dashboard__chips">
        <span class="status-chip status-chip--live">
          <span class="status-chip__dot"></span>
          กลุ่มรันอยู่ <span id="chip-group-running">0</span>
        </span>
        <span class="status-chip status-chip--page">
          <i class="bi bi-layers"></i>
          Page รันอยู่ <span id="chip-page-running">0</span>
        </span>
        <span class="status-chip status-chip--inference">
          <i class="bi bi-activity"></i>
          กล้องกำลังรัน <span id="chip-inference-running">0</span>
        </span>
        <span class="status-chip status-chip--sync">
          <i class="bi bi-arrow-repeat"></i>
          รีเฟรชทุก <span id="chip-refresh">6</span> วินาที
        </span>
        <span class="status-chip status-chip--roi">
          <i class="bi bi-bounding-box-circles"></i>
          ROI ทั้งหมด <span id="metric-total-roi-chip">0</span>
        </span>
      </div>
    </div>
    <div class="dashboard__meta">
      <span class="badge bg-primary-subtle text-primary fw-semibold">
        อัปเดตล่าสุด <span id="dashboard-updated">-</span>
      </span>
    </div>
  </div>

  <div class="dashboard__stats">
    <div class="summary-stat">
      <p class="summary-stat__label">อัตราออนไลน์</p>
      <p class="summary-stat__value" id="summary-online-rate">0%</p>
      <p class="summary-stat__meta">จากกล้องทั้งหมด</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">ROI แบบโซน</p>
      <p class="summary-stat__value" id="summary-roi-zones">0</p>
      <p class="summary-stat__meta">โซนสำหรับกล้องสด</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">Page Templates</p>
      <p class="summary-stat__value" id="summary-page-templates">0</p>
      <p class="summary-stat__meta">ใช้ OCR แบบเอกสาร</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">ความหนาแน่นแจ้งเตือน</p>
      <p class="summary-stat__value" id="summary-alert-density">0.00</p>
      <p class="summary-stat__meta">ต่อกล้อง/ชั่วโมง</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">โมดูลที่ใช้งาน</p>
      <p class="summary-stat__value" id="summary-module-types">0</p>
      <p class="summary-stat__meta">ครอบคลุม <span id="summary-total-roi">0</span> ROI</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">Interval เฉลี่ย</p>
      <p class="summary-stat__value" id="summary-average-interval">0.0s</p>
      <p class="summary-stat__meta">OCR ใช้ <span id="summary-average-cycle">0.0s</span></p>
    </div>
  </div>

  <section class="dashboard__analytics">
    <article class="analytics-card">
      <div class="analytics-card__header">
        <span class="analytics-card__icon bg-primary-subtle text-primary"><i class="bi bi-diagram-3"></i></span>
        <div>
          <h2 class="analytics-card__title">ภาพรวมโมดูล Inference</h2>
          <p class="analytics-card__subtitle">ดูจำนวน ROI ที่แต่ละโมดูลดูแลและจำนวนกล้องที่ใช้งาน</p>
        </div>
      </div>
      <div class="analytics-card__body" id="module-summary">
        <p class="analytics-card__empty">ยังไม่มีโมดูลที่ถูกกำหนดใน ROI</p>
      </div>
    </article>

    <article class="analytics-card analytics-card--dark">
      <div class="analytics-card__header">
        <span class="analytics-card__icon analytics-card__icon--dark"><i class="bi bi-speedometer2"></i></span>
        <div>
          <h2 class="analytics-card__title">ประสิทธิภาพ OCR และ Interval</h2>
          <p class="analytics-card__subtitle">ตรวจสอบเวลาที่ระบบใช้ต่อรอบและความสอดคล้องกับค่า interval ที่ตั้งไว้</p>
        </div>
      </div>
      <div class="analytics-card__body">
        <div class="processing-metrics">
          <div class="processing-metrics__item">
            <p class="processing-metrics__label">เวลารวมต่อรอบ</p>
            <p class="processing-metrics__value" id="processing-cycle-average">0.00s</p>
            <p class="processing-metrics__meta">สูงสุด <span id="processing-cycle-max">0.00s</span></p>
          </div>
          <div class="processing-metrics__item">
            <p class="processing-metrics__label">เวลาเฉลี่ยต่อ ROI</p>
            <p class="processing-metrics__value" id="processing-roi-average">0.00s</p>
            <p class="processing-metrics__meta">P95 <span id="processing-roi-p95">0.00s</span></p>
          </div>
          <div class="processing-metrics__item processing-metrics__item--status">
            <p class="processing-metrics__label">สถานะ Interval</p>
            <p class="processing-metrics__value" id="processing-interval-status">รอข้อมูล</p>
            <p class="processing-metrics__meta" id="processing-interval-meta">-</p>
          </div>
        </div>
        <div class="processing-metrics__divider"></div>
        <div class="interval-issues">
          <h4 class="interval-issues__title">กล้องที่อาจต้องปรับ interval</h4>
          <ul class="interval-issues__list" id="interval-issues">
            <li class="interval-issues__empty">ยังไม่พบความล่าช้า</li>
          </ul>
        </div>
      </div>
    </article>
  </section>

  <section class="dashboard__insights">
    <article class="insight-card">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-success-subtle text-success"><i class="bi bi-activity"></i></span>
        <div>
          <h3 class="insight-card__title">ภาพรวม ROI</h3>
          <p class="insight-card__subtitle">ดูจำนวนโซนกับเทมเพลตเอกสารที่ระบบกำลังใช้</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value"><span id="insight-roi-total">0</span> ROI</p>
        <div class="insight-distribution">
          <div class="insight-distribution__item">
            <div class="insight-distribution__top">
              <span>ROI โซน</span>
              <span id="insight-roi-zones">0</span>
            </div>
            <div class="insight-card__progress">
              <div class="insight-card__progress-track">
                <div class="insight-card__progress-fill" id="progress-roi-zone"></div>
              </div>
              <div class="insight-card__progress-meta">
                <span>สัดส่วน</span>
                <span id="insight-roi-zone-share">0%</span>
              </div>
            </div>
          </div>
          <div class="insight-distribution__item">
            <div class="insight-distribution__top">
              <span>Page Templates</span>
              <span id="insight-roi-pages">0</span>
            </div>
            <div class="insight-card__progress">
              <div class="insight-card__progress-track">
                <div class="insight-card__progress-fill insight-card__progress-fill--warm" id="progress-roi-page"></div>
              </div>
              <div class="insight-card__progress-meta">
                <span>สัดส่วน</span>
                <span id="insight-roi-page-share">0%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </article>
    <article class="insight-card">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-warning-subtle text-warning"><i class="bi bi-gpu-card"></i></span>
        <div>
          <h3 class="insight-card__title">โหลดการประมวลผล</h3>
          <p class="insight-card__subtitle">จำนวนงาน Inference ที่กำลังทำงาน</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value"><span id="insight-running">0</span> งาน</p>
        <p class="insight-card__meta">คิดเป็น <span id="insight-running-rate">0%</span> ของกล้องทั้งหมด</p>
        <div class="insight-card__progress">
          <div class="insight-card__progress-track">
            <div class="insight-card__progress-fill insight-card__progress-fill--warm" id="progress-utilization"></div>
          </div>
          <div class="insight-card__progress-meta">
            <span>Average FPS</span>
            <span id="insight-average-fps">0.0</span>
          </div>
        </div>
      </div>
    </article>
    <article class="insight-card insight-card--alert">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-danger-subtle text-danger"><i class="bi bi-bell"></i></span>
        <div>
          <h3 class="insight-card__title">การแจ้งเตือนล่าสุด</h3>
          <p class="insight-card__subtitle">ความถี่ของเหตุการณ์ในชั่วโมงที่ผ่านมา</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value"><span id="insight-alerts">0</span> ครั้ง/ชม.</p>
        <p class="insight-card__meta">เกิดจาก <span id="insight-alert-active">0</span> กล้อง</p>
        <div class="insight-card__progress">
          <div class="insight-card__progress-track">
            <div class="insight-card__progress-fill insight-card__progress-fill--alert" id="progress-alerts"></div>
          </div>
          <div class="insight-card__progress-meta">
            <span>Top Camera</span>
            <span id="insight-top-camera">-</span>
          </div>
        </div>
      </div>
      <div class="insight-card__footer">
        <span class="insight-card__footer-meta"><i class="bi bi-clock-history"></i> อัปเดต <span id="insight-alert-latest">-</span></span>
      </div>
    </article>
  </section>

  <section class="dashboard__panel dashboard__panel--wide dashboard__panel--accent">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">สรุปกลุ่ม Inference</h2>
        <p class="panel-subtitle">ดูความหนาแน่นของงานในแต่ละกลุ่ม ค่า FPS เฉลี่ย และจำนวนการแจ้งเตือนล่าสุด</p>
      </div>
    </div>
    <div class="group-overview" id="group-overview">
      <div class="group-overview__empty">ยังไม่มีกลุ่มที่สร้างไว้</div>
    </div>
  </section>

  <section class="dashboard__panel dashboard__panel--wide">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพรวม Page Inference</h2>
        <p class="panel-subtitle">ติดตามงานแบบหน้า (Page) สำหรับเอกสารหรือฟอร์มที่กำลังประมวลผล</p>
      </div>
    </div>
    <div class="page-overview" id="page-overview">
      <div class="page-overview__empty">ยังไม่มีงาน Page Inference</div>
    </div>
  </section>

  <div class="dashboard__content">
    <section class="dashboard__panel dashboard__panel--wide">
      <div class="panel-header">
        <div>
          <h2 class="panel-title">สถานะกล้องและงานประมวลผล</h2>
          <p class="panel-subtitle">ดูรายละเอียดกล้องทั้งหมดพร้อมสถานะ กลุ่มที่รันอยู่ ความละเอียด และข้อมูลล่าสุด</p>
        </div>
      </div>
      <div class="table-responsive dashboard__table-wrapper">
        <table class="table align-middle table-hover" id="camera-table">
          <thead>
            <tr>
              <th>กล้อง</th>
              <th>ชื่อ/แหล่งสัญญาณ</th>
              <th>ความละเอียด</th>
              <th>สถานะ</th>
              <th>กลุ่มที่กำลังใช้</th>
              <th>Interval</th>
              <th>FPS โดยประมาณ</th>
              <th>ผลล่าสุด</th>
              <th>แจ้งเตือน</th>
              <th>อัปเดตล่าสุด</th>
            </tr>
          </thead>
          <tbody id="camera-table-body">
            <tr>
              <td colspan="10" class="text-center text-muted py-4">ไม่มีข้อมูลกล้อง</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <aside class="dashboard__sidebar">
      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">สรุปแจ้งเตือน</h2>
            <p class="panel-subtitle">ดูภาพรวมเหตุการณ์ที่เกิดขึ้นบ่อยและเวลาอัปเดตล่าสุด</p>
          </div>
        </div>
        <div class="alert-summary" id="alert-summary">
          <div class="alert-summary__empty">ยังไม่มีแจ้งเตือน</div>
        </div>
      </section>
      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">แจ้งเตือนล่าสุด</h2>
            <p class="panel-subtitle">ผลลัพธ์ที่ระบบบันทึกไว้ล่าสุด (สูงสุด 10 รายการ)</p>
          </div>
        </div>
        <ul class="timeline" id="alert-timeline">
          <li class="timeline__empty">ยังไม่มีแจ้งเตือน</li>
        </ul>
      </section>

    </aside>
  </div>

  <section class="dashboard__panel">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพตัวอย่างสด</h2>
        <p class="panel-subtitle">ตรวจสอบภาพย่อจากกล้องที่กำลังรันอยู่ คลิกเพื่อเปิดเต็มหน้าจอ</p>
      </div>
    </div>
    <div class="stream-grid" id="stream-grid">
      <div class="stream-grid__empty text-muted">ยังไม่มีกล้องที่กำลังประมวลผล</div>
    </div>
  </section>
</div>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
