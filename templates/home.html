{% extends "base.html" %}
{% block title %}หน้าแรก{% endblock %}
{% block shell_classes %}app-shell--fluid{% endblock %}
{% block content %}
<div class="dashboard">
  <div class="dashboard__header">
    <div class="dashboard__heading">
      <div>
        <h1 class="dashboard__title">แดชบอร์ดภาพรวมงาน</h1>
        <p class="dashboard__subtitle">ติดตามสถานะกล้อง งาน Inference แบบกลุ่มและแบบหน้าได้ในที่เดียว</p>
      </div>
      <div class="dashboard__chips">
        <span class="status-chip status-chip--live">
          <span class="status-chip__dot"></span>
          กลุ่มรันอยู่ <span id="chip-group-running">0</span>
        </span>
        <span class="status-chip status-chip--processing">
          <i class="bi bi-camera-video"></i>
          กล้องรันอยู่ <span id="chip-camera-running">0</span>
        </span>
        <span class="status-chip status-chip--page">
          <i class="bi bi-layers"></i>
          Page รันอยู่ <span id="chip-page-running">0</span>
        </span>
        <span class="status-chip status-chip--sync">
          <i class="bi bi-arrow-repeat"></i>
          รีเฟรชทุก <span id="chip-refresh">6</span> วินาที
        </span>
        <span class="status-chip status-chip--roi">
          <i class="bi bi-bounding-box-circles"></i>
          ROI ทั้งหมด <span id="metric-total-roi-chip">0</span>
        </span>
      </div>
    </div>
    <div class="dashboard__meta">
      <span class="badge bg-primary-subtle text-primary fw-semibold">
        อัปเดตล่าสุด <span id="dashboard-updated">-</span>
      </span>
    </div>
  </div>

  <div class="dashboard__stats">
    <div class="summary-stat">
      <p class="summary-stat__label">อัตราออนไลน์</p>
      <p class="summary-stat__value" id="summary-online-rate">0%</p>
      <p class="summary-stat__meta">จากกล้องทั้งหมด</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">กล้องออฟไลน์</p>
      <p class="summary-stat__value" id="summary-offline">0</p>
      <p class="summary-stat__meta">ต้องติดตาม</p>
    </div>
    <div class="summary-stat">
      <p class="summary-stat__label">ความหนาแน่นแจ้งเตือน</p>
      <p class="summary-stat__value" id="summary-alert-density">0.00</p>
      <p class="summary-stat__meta">ต่อกล้อง/ชั่วโมง</p>
    </div>
  </div>

  <section class="dashboard__metrics">
    <div class="metric-card" data-metric="total">
      <div class="metric-card__icon bg-primary text-white"><i class="bi bi-camera-video"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">จำนวนกล้องทั้งหมด</p>
        <p class="metric-card__value" id="metric-total">0</p>
        <p class="metric-card__meta">ROI เฝ้าระวัง <span id="metric-total-roi">0</span> โซน</p>
      </div>
    </div>
    <div class="metric-card" data-metric="online">
      <div class="metric-card__icon bg-success text-white"><i class="bi bi-wifi"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">กล้องออนไลน์</p>
        <p class="metric-card__value" id="metric-online">0</p>
        <p class="metric-card__meta">คิดเป็น <span id="metric-online-rate-meta">0%</span></p>
      </div>
    </div>
    <div class="metric-card" data-metric="running">
      <div class="metric-card__icon bg-warning text-dark"><i class="bi bi-cpu"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">Inference ที่กำลังรัน</p>
        <p class="metric-card__value" id="metric-running">0</p>
        <p class="metric-card__meta">โหลดระบบ <span id="metric-running-ratio">0%</span></p>
      </div>
    </div>
    <div class="metric-card" data-metric="groups">
      <div class="metric-card__icon bg-secondary text-white"><i class="bi bi-diagram-3"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">จำนวนกลุ่ม</p>
        <p class="metric-card__value" id="metric-groups">0</p>
        <p class="metric-card__meta">รันอยู่ <span id="metric-groups-running">0</span> กลุ่ม</p>
      </div>
    </div>
    <div class="metric-card" data-metric="alerts">
      <div class="metric-card__icon bg-danger text-white"><i class="bi bi-bell"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">แจ้งเตือนชั่วโมงล่าสุด</p>
        <p class="metric-card__value" id="metric-alerts">0</p>
        <p class="metric-card__meta">เฉลี่ย <span id="metric-alert-density">0.00</span> / กล้อง</p>
      </div>
    </div>
    <div class="metric-card" data-metric="interval">
      <div class="metric-card__icon bg-info text-dark"><i class="bi bi-stopwatch"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">Interval เฉลี่ย (วินาที)</p>
        <p class="metric-card__value" id="metric-interval">0.0</p>
        <p class="metric-card__meta">เร็วที่สุด <span id="metric-min-interval">-</span></p>
      </div>
    </div>
    <div class="metric-card" data-metric="fps">
      <div class="metric-card__icon bg-dark text-white"><i class="bi bi-graph-up"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">FPS เฉลี่ย</p>
        <p class="metric-card__value" id="metric-fps">0.0</p>
        <p class="metric-card__meta">สูงสุด <span id="metric-max-fps">-</span></p>
      </div>
    </div>
    <div class="metric-card" data-metric="pages">
      <div class="metric-card__icon bg-primary-subtle text-primary"><i class="bi bi-journal-text"></i></div>
      <div class="metric-card__body">
        <p class="metric-card__label">งาน Page ทั้งหมด</p>
        <p class="metric-card__value" id="metric-pages">0</p>
        <p class="metric-card__meta">กำลังรัน <span id="metric-pages-running">0</span> งาน</p>
      </div>
    </div>
  </section>

  <section class="dashboard__panel dashboard__panel--wide">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ROI และโมดูลที่ใช้งาน</h2>
        <p class="panel-subtitle">สรุปจำนวน ROI ทั้งหมด โมดูลที่ทำงานอยู่ และประสิทธิภาพการประมวลผลล่าสุด</p>
      </div>
    </div>
    <div class="roi-overview">
      <div class="roi-overview__stats">
        <div class="roi-stat">
          <p class="roi-stat__label">ROI ทั้งหมด</p>
          <p class="roi-stat__value" id="roi-total-count">0</p>
          <p class="roi-stat__meta">รวมทุกแหล่งสัญญาณ</p>
        </div>
        <div class="roi-stat">
          <p class="roi-stat__label">โมดูลที่ใช้งาน</p>
          <p class="roi-stat__value" id="roi-module-count">0</p>
          <p class="roi-stat__meta">โมดูลที่แตกต่างกัน</p>
        </div>
        <div class="roi-stat">
          <p class="roi-stat__label">แหล่งสัญญาณมี ROI</p>
          <p class="roi-stat__value" id="roi-source-count">0</p>
          <p class="roi-stat__meta">กล้องหรือ Page ที่ตั้งค่าไว้</p>
        </div>
        <div class="roi-stat">
          <p class="roi-stat__label">กล้องรัน Inference</p>
          <p class="roi-stat__value" id="roi-running-count">0</p>
          <p class="roi-stat__meta">ออนไลน์ในระบบ</p>
        </div>
      </div>
      <div class="roi-overview__body">
        <div class="roi-overview__modules">
          <h3 class="roi-overview__title">โมดูลที่กำลังใช้งาน</h3>
          <div class="roi-module-list" id="roi-module-list">
            <div class="roi-module-list__empty">ยังไม่มีการกำหนด ROI</div>
          </div>
        </div>
        <div class="roi-overview__performance">
          <h3 class="roi-overview__title">เวลาในการประมวลผลของโมดูล</h3>
          <div class="performance-cards">
            <div class="performance-card performance-card--fast">
              <p class="performance-card__label">เร็วที่สุด</p>
              <h4 class="performance-card__title" id="module-fastest-name">-</h4>
              <p class="performance-card__value" id="module-fastest-duration">-</p>
              <p class="performance-card__meta" id="module-fastest-meta">รอข้อมูล</p>
            </div>
            <div class="performance-card performance-card--slow">
              <p class="performance-card__label">ช้าที่สุด</p>
              <h4 class="performance-card__title" id="module-slowest-name">-</h4>
              <p class="performance-card__value" id="module-slowest-duration">-</p>
              <p class="performance-card__meta" id="module-slowest-meta">รอข้อมูล</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="dashboard__panel dashboard__panel--wide">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพรวม ROI ต่อแหล่งสัญญาณ</h2>
        <p class="panel-subtitle">ตรวจสอบโมดูลที่ใช้ร่วมกับเวลาประมวลผลจริง เทียบกับ Interval ที่ตั้งไว้</p>
      </div>
    </div>
    <div class="table-responsive dashboard__table-wrapper dashboard__table-wrapper--compact">
      <table class="table align-middle table-hover" id="roi-source-table">
        <thead>
          <tr>
            <th>แหล่งสัญญาณ</th>
            <th>กลุ่ม</th>
            <th>จำนวน ROI</th>
            <th>โมดูล</th>
            <th>เวลาเฉลี่ย</th>
            <th>สูงสุด</th>
            <th>Interval</th>
            <th>สถานะ</th>
          </tr>
        </thead>
        <tbody id="roi-source-table-body">
          <tr>
            <td colspan="8" class="text-center text-muted py-4">ยังไม่มีการตั้งค่า ROI</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="dashboard__insights">
    <article class="insight-card">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-success-subtle text-success"><i class="bi bi-activity"></i></span>
        <div>
          <h3 class="insight-card__title">ความพร้อมของกล้อง</h3>
          <p class="insight-card__subtitle">การออนไลน์ของอุปกรณ์ทั้งหมด</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value" id="insight-online-value">0 / 0</p>
        <p class="insight-card__meta">ออฟไลน์ <span id="insight-offline">0</span> กล้อง</p>
        <div class="insight-card__progress">
          <div class="insight-card__progress-track">
            <div class="insight-card__progress-fill" id="progress-online"></div>
          </div>
          <div class="insight-card__progress-meta">
            <span>ออนไลน์</span>
            <span id="insight-online-rate">0%</span>
          </div>
        </div>
      </div>
    </article>
    <article class="insight-card">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-warning-subtle text-warning"><i class="bi bi-gpu-card"></i></span>
        <div>
          <h3 class="insight-card__title">โหลดการประมวลผล</h3>
          <p class="insight-card__subtitle">จำนวนงาน Inference ที่กำลังทำงาน</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value"><span id="insight-running">0</span> งาน</p>
        <p class="insight-card__meta">คิดเป็น <span id="insight-running-rate">0%</span> ของกล้องทั้งหมด</p>
        <div class="insight-card__progress">
          <div class="insight-card__progress-track">
            <div class="insight-card__progress-fill insight-card__progress-fill--warm" id="progress-utilization"></div>
          </div>
          <div class="insight-card__progress-meta">
            <span>Average FPS</span>
            <span id="insight-average-fps">0.0</span>
          </div>
        </div>
      </div>
    </article>
    <article class="insight-card insight-card--alert">
      <div class="insight-card__header">
        <span class="insight-card__icon bg-danger-subtle text-danger"><i class="bi bi-bell"></i></span>
        <div>
          <h3 class="insight-card__title">การแจ้งเตือนล่าสุด</h3>
          <p class="insight-card__subtitle">ความถี่ของเหตุการณ์ในชั่วโมงที่ผ่านมา</p>
        </div>
      </div>
      <div class="insight-card__body">
        <p class="insight-card__value"><span id="insight-alerts">0</span> ครั้ง/ชม.</p>
        <p class="insight-card__meta">เกิดจาก <span id="insight-alert-active">0</span> กล้อง</p>
        <div class="insight-card__progress">
          <div class="insight-card__progress-track">
            <div class="insight-card__progress-fill insight-card__progress-fill--alert" id="progress-alerts"></div>
          </div>
          <div class="insight-card__progress-meta">
            <span>Top Camera</span>
            <span id="insight-top-camera">-</span>
          </div>
        </div>
      </div>
      <div class="insight-card__footer">
        <span class="insight-card__footer-meta"><i class="bi bi-clock-history"></i> อัปเดต <span id="insight-alert-latest">-</span></span>
      </div>
    </article>
  </section>

  <section class="dashboard__panel dashboard__panel--wide dashboard__panel--accent">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">สรุปกลุ่ม Inference</h2>
        <p class="panel-subtitle">ดูความหนาแน่นของงานในแต่ละกลุ่ม ค่า FPS เฉลี่ย และจำนวนการแจ้งเตือนล่าสุด</p>
      </div>
    </div>
    <div class="group-overview" id="group-overview">
      <div class="group-overview__empty">ยังไม่มีกลุ่มที่สร้างไว้</div>
    </div>
  </section>

  <section class="dashboard__panel dashboard__panel--wide">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพรวม Page Inference</h2>
        <p class="panel-subtitle">ติดตามงานแบบหน้า (Page) สำหรับเอกสารหรือฟอร์มที่กำลังประมวลผล</p>
      </div>
    </div>
    <div class="page-overview" id="page-overview">
      <div class="page-overview__empty">ยังไม่มีงาน Page Inference</div>
    </div>
  </section>

  <div class="dashboard__content">
    <section class="dashboard__panel dashboard__panel--wide">
      <div class="panel-header">
        <div>
          <h2 class="panel-title">สถานะกล้องและงานประมวลผล</h2>
          <p class="panel-subtitle">ดูรายละเอียดกล้องทั้งหมดพร้อมสถานะ กลุ่มที่รันอยู่ ความละเอียด และข้อมูลล่าสุด</p>
        </div>
      </div>
      <div class="table-responsive dashboard__table-wrapper">
        <table class="table align-middle table-hover" id="camera-table">
          <thead>
            <tr>
              <th>กล้อง</th>
              <th>ชื่อ/แหล่งสัญญาณ</th>
              <th>ความละเอียด</th>
              <th>สถานะ</th>
              <th>กลุ่มที่กำลังใช้</th>
              <th>Interval</th>
              <th>FPS โดยประมาณ</th>
              <th>ผลล่าสุด</th>
              <th>แจ้งเตือน</th>
              <th>อัปเดตล่าสุด</th>
            </tr>
          </thead>
          <tbody id="camera-table-body">
            <tr>
              <td colspan="10" class="text-center text-muted py-4">ไม่มีข้อมูลกล้อง</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <aside class="dashboard__sidebar">
      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">สรุปแจ้งเตือน</h2>
            <p class="panel-subtitle">ดูภาพรวมเหตุการณ์ที่เกิดขึ้นบ่อยและเวลาอัปเดตล่าสุด</p>
          </div>
        </div>
        <div class="alert-summary" id="alert-summary">
          <div class="alert-summary__empty">ยังไม่มีแจ้งเตือน</div>
        </div>
      </section>
      <section class="dashboard__panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">แจ้งเตือนล่าสุด</h2>
            <p class="panel-subtitle">ผลลัพธ์ที่ระบบบันทึกไว้ล่าสุด (สูงสุด 20 รายการ)</p>
          </div>
        </div>
        <ul class="timeline" id="alert-timeline">
          <li class="timeline__empty">ยังไม่มีแจ้งเตือน</li>
        </ul>
      </section>

    </aside>
  </div>

  <section class="dashboard__panel">
    <div class="panel-header">
      <div>
        <h2 class="panel-title">ภาพตัวอย่างสด</h2>
        <p class="panel-subtitle">ตรวจสอบภาพย่อจากกล้องที่กำลังรันอยู่ คลิกเพื่อเปิดเต็มหน้าจอ</p>
      </div>
    </div>
    <div class="stream-grid" id="stream-grid">
      <div class="stream-grid__empty text-muted">ยังไม่มีกล้องที่กำลังประมวลผล</div>
    </div>
  </section>
</div>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
